

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MODELO PREDICTIVO CON SERIES DE TIEMPO &#8212; TAREA N° 2  Modelo Predictivo con series de tiempo</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="TAREA 2: SERIES DE TIEMPO" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="TAREA N° 2  Modelo Predictivo con series de tiempo - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="TAREA N° 2  Modelo Predictivo con series de tiempo - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    TAREA 2: SERIES DE TIEMPO
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">MODELO PREDICTIVO CON SERIES DE TIEMPO</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MODELO PREDICTIVO CON SERIES DE TIEMPO</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos-eda">ANÁLISIS EXPLORATORIO DE LOS DATOS (EDA)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-faltantes">Datos faltantes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-arima">MODELO ARIMA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-rolling">ENFOQUE ROLLING</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-akaike-aic">Criterio de Akaike (AIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-informacion-de-hannan-quinn-hqic">Criterio de Información de Hannan-Quinn (HQIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-de-normalidad-en-los-residuos">Prueba de normalidad en los residuos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-sin-rolling">ENFOQUE SIN ROLLING</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Criterio de Akaike (AIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Criterio de Información de Hannan-Quinn (HQIC)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">CONCLUSIONES</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelo-predictivo-con-series-de-tiempo">
<h1>MODELO PREDICTIVO CON SERIES DE TIEMPO<a class="headerlink" href="#modelo-predictivo-con-series-de-tiempo" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">finnhub</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<section id="analisis-exploratorio-de-los-datos-eda">
<h2>ANÁLISIS EXPLORATORIO DE LOS DATOS (EDA)<a class="headerlink" href="#analisis-exploratorio-de-los-datos-eda" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<span class="n">finnhub_client</span> <span class="o">=</span> <span class="n">finnhub</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;ckuiql1r01qmtr8l8dvgckuiql1r01qmtr8l8e00&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  
<span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">crypto_candles</span><span class="p">(</span><span class="s1">&#39;BINANCE:BTCUSDT&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="mi">1502928000</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">BTC_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">crypto_candles</span><span class="p">(</span><span class="s1">&#39;BINANCE:BTCUSDT&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="mi">1502928000</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">BTC_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="nn">File C:\python_venv\psqlpy_venv\Lib\site-packages\pandas\core\frame.py:733,</span> in <span class="ni">DataFrame.__init__</span><span class="nt">(self, data, index, columns, dtype, copy)</span>
<span class="g g-Whitespace">    </span><span class="mi">727</span>     <span class="n">mgr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_mgr</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">728</span>         <span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">columns</span><span class="p">},</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span>
<span class="g g-Whitespace">    </span><span class="mi">729</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">731</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">732</span>     <span class="c1"># GH#38939 de facto copy defaults to False only in non-dict cases</span>
<span class="ne">--&gt; </span><span class="mi">733</span>     <span class="n">mgr</span> <span class="o">=</span> <span class="n">dict_to_mgr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">manager</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">734</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">735</span>     <span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">mrecords</span>

<span class="nn">File C:\python_venv\psqlpy_venv\Lib\site-packages\pandas\core\internals\construction.py:503,</span> in <span class="ni">dict_to_mgr</span><span class="nt">(data, index, columns, dtype, typ, copy)</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span>         <span class="c1"># dtype check to exclude e.g. range objects, scalars</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span>         <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">503</span> <span class="k">return</span> <span class="n">arrays_to_mgr</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">,</span> <span class="n">consolidate</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>

<span class="nn">File C:\python_venv\psqlpy_venv\Lib\site-packages\pandas\core\internals\construction.py:114,</span> in <span class="ni">arrays_to_mgr</span><span class="nt">(arrays, columns, index, dtype, verify_integrity, typ, consolidate)</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span> <span class="k">if</span> <span class="n">verify_integrity</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>     <span class="c1"># figure out the index, if necessary</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span>     <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">114</span>         <span class="n">index</span> <span class="o">=</span> <span class="n">_extract_index</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span>         <span class="n">index</span> <span class="o">=</span> <span class="n">ensure_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="nn">File C:\python_venv\psqlpy_venv\Lib\site-packages\pandas\core\internals\construction.py:667,</span> in <span class="ni">_extract_index</span><span class="nt">(data)</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Per-column arrays must each be 1-dimensional&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">indexes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">raw_lengths</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">667</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If using all scalar values, you must pass an index&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">669</span> <span class="k">if</span> <span class="n">have_series</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span>     <span class="n">index</span> <span class="o">=</span> <span class="n">union_indexes</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>

<span class="ne">ValueError</span>: If using all scalar values, you must pass an index
</pre></div>
</div>
</div>
</div>
<section id="datos-faltantes">
<h3>Datos faltantes<a class="headerlink" href="#datos-faltantes" title="Permalink to this heading">#</a></h3>
<p>No se encontraron datos faltantes en el conjunto de datos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_data</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c    0
h    0
l    0
o    0
s    0
t    0
v    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">date_col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BTC_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4285.08</td>
      <td>4485.39</td>
      <td>4200.74</td>
      <td>4261.48</td>
      <td>ok</td>
      <td>2017-08-16</td>
      <td>795.150377</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4108.37</td>
      <td>4371.52</td>
      <td>3938.77</td>
      <td>4285.08</td>
      <td>ok</td>
      <td>2017-08-17</td>
      <td>1199.888264</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4139.98</td>
      <td>4184.69</td>
      <td>3850.00</td>
      <td>4108.37</td>
      <td>ok</td>
      <td>2017-08-18</td>
      <td>381.309763</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4086.29</td>
      <td>4211.08</td>
      <td>4032.62</td>
      <td>4120.98</td>
      <td>ok</td>
      <td>2017-08-19</td>
      <td>467.083022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4016.00</td>
      <td>4119.62</td>
      <td>3911.79</td>
      <td>4069.13</td>
      <td>ok</td>
      <td>2017-08-20</td>
      <td>691.743060</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>La base de datos tiene 6 columnas:</p>
<ul class="simple">
<li><p>Date: fecha en la que se registraron los datos.</p></li>
<li><p>Open: El precio de apertura de un activo financiero en la fecha especificada. El precio de apertura es el primer precio al que se negoció un activo en un día determinado.</p></li>
<li><p>High: El precio más alto alcanzado por el activo durante el día</p></li>
<li><p>Low: el precio más bajo alcanzado por el activo durante el día.</p></li>
<li><p>Close:  el precio de cierre del activo en la fecha especificada. El precio de cierre es el último precio al que se negoció un activo en un día determinado.</p></li>
<li><p>Volume: volumen de activos negociados en la fecha especificada. Representa la cantidad de activos que se compraron y vendieron durante el período.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BTC_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;High&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">:</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="s1">&#39;Volume&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Date</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4285.08</td>
      <td>4485.39</td>
      <td>4200.74</td>
      <td>4261.48</td>
      <td>2017-08-16</td>
      <td>795.150377</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4108.37</td>
      <td>4371.52</td>
      <td>3938.77</td>
      <td>4285.08</td>
      <td>2017-08-17</td>
      <td>1199.888264</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4139.98</td>
      <td>4184.69</td>
      <td>3850.00</td>
      <td>4108.37</td>
      <td>2017-08-18</td>
      <td>381.309763</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4086.29</td>
      <td>4211.08</td>
      <td>4032.62</td>
      <td>4120.98</td>
      <td>2017-08-19</td>
      <td>467.083022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4016.00</td>
      <td>4119.62</td>
      <td>3911.79</td>
      <td>4069.13</td>
      <td>2017-08-20</td>
      <td>691.743060</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">BTC_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2273
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BTC_df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Date</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2272</th>
      <td>34826.65</td>
      <td>35118.71</td>
      <td>34820.3</td>
      <td>35011.89</td>
      <td>2023-11-05</td>
      <td>4808.01422</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Gráfico de velas</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
                                     <span class="nb">open</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span> 
                                     <span class="n">high</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">High</span><span class="p">,</span>
                                     <span class="n">low</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> 
                                     <span class="n">close</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
                     <span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;BITCON (BTC)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;BTC-USD&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Una operación fundamental para entender el comportamiento de una serie de tiempo y poder determinar si se trata de una serie estacionaria o no; es realizar gráficos de la misma.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">BTC_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Close&quot;</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3434445edb1cd1877a6caf38855a70a405fb731b7bf08826e96a2d09f060575a.png" src="_images/3434445edb1cd1877a6caf38855a70a405fb731b7bf08826e96a2d09f060575a.png" />
</div>
</div>
<p>De gráfico anterior puede concluirse que en efecto la serie de tiempo no es estacionaria, sin embargo se realizará la prueba ADF para verificar dicha hipótesis.</p>
<ul class="simple">
<li><p>Ho: No estacionariedad</p></li>
<li><p>H1: Estacionariedad</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -1.658264
p-value: 0.452734
</pre></div>
</div>
</div>
</div>
<p>Dado que el p-valor es mayor que el nivel de significancia (0.05), no se rechaza la hipótesis nula. La serie de tiempo es no estacionaria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Serie Original&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2200</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39; Diferenciación de 1er Orden&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2200</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diferenciación de 2do Orden&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">2200</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b4cd2b7f3ca872fa36e63db3ba41e0b69a5604b41a2dc65f801382ec2864a036.png" src="_images/b4cd2b7f3ca872fa36e63db3ba41e0b69a5604b41a2dc65f801382ec2864a036.png" />
</div>
</div>
<p>cuando analizamos el gráfico de autocorrelación para la segunda diferencia de la serie de tiempo, notamos que el retraso se vuelve negativo de manera rápida, sugiriendo que podríamos haber aplicado demasiadas diferenciaciones a la serie. Esto podría no ser necesario.</p>
</section>
</section>
<section id="modelo-arima">
<h2>MODELO ARIMA<a class="headerlink" href="#modelo-arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir los rangos de valores para p, d, q</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente autorregresivo</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Orden de diferenciación</span>
<span class="n">q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente de media móvil</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Datos de entrenamiento + validación:</p></li>
</ul>
<p>Se tomará un conjunto de 2244 datos para realizar el respectivo entrenamiento y validación del modelo arima.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_BTC</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">BTC_df</span><span class="p">)</span>
<span class="n">Train_size</span><span class="o">=</span><span class="n">N_BTC</span><span class="o">-</span><span class="mi">28</span>
<span class="n">Train_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2245
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Datos de prueba:</p></li>
</ul>
<p>Se fijara un conjunto de dados para prueba de tamaño 28  el cuals e usará para testear el mejor modelo en distintos horizontes (7,14,21,28), esto con el fin de comparar la generalización del modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Test_size</span><span class="o">=</span><span class="n">N_BTC</span><span class="o">-</span><span class="n">Train_size</span>
<span class="n">Test_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28
</pre></div>
</div>
</div>
</div>
<section id="enfoque-rolling">
<h3>ENFOQUE ROLLING<a class="headerlink" href="#enfoque-rolling" title="Permalink to this heading">#</a></h3>
<p>El enfoque de rolling en ARIMA implica ajustar un modelo ARIMA a un subconjunto de los datos de la serie de tiempo y usar ese modelo para realizar pronósticos en un punto específico en el futuro. Luego, se desliza la ventana temporal hacia adelante en el tiempo, se ajusta un nuevo modelo ARIMA en el nuevo conjunto de datos dentro de la ventana y se realiza otro pronóstico. Esto se repite a lo largo de toda la serie de tiempo, lo que permite evaluar continuamente la calidad de las predicciones a medida que se avanza en el tiempo.</p>
<section id="criterio-de-akaike-aic">
<h4>Criterio de Akaike (AIC)<a class="headerlink" href="#criterio-de-akaike-aic" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grid_search_ARIMA_AIC</span><span class="p">(</span><span class="n">serie</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">best_order_aic</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">best_aic</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="c1"># Generar todas las combinaciones posibles de valores de p, d, q</span>
    <span class="c1">#los parámetros p (orden del componente autorregresivo),</span>
    <span class="c1">#  d (orden de diferenciación) y </span>
    <span class="c1"># q (orden del componente de media móvil).</span>
    <span class="n">orders</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp_model</span><span class="o">=</span><span class="n">ARIMA</span><span class="p">(</span><span class="n">serie</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">tm_aic</span> <span class="o">=</span> <span class="n">tmp_model</span><span class="o">.</span><span class="n">aic</span>
            <span class="k">if</span> <span class="n">tm_aic</span><span class="o">&lt;</span><span class="n">best_aic</span><span class="p">:</span>
                <span class="n">best_aic</span><span class="o">=</span><span class="n">tm_aic</span>
                <span class="n">best_order_aic</span><span class="o">=</span><span class="n">order</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">best_order_aic</span><span class="p">,</span><span class="n">best_aic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hzt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  <span class="c1"># Valores de horizontes</span>
<span class="n">n_BTC</span> <span class="o">=</span> <span class="n">Train_size</span>

<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">hzt_values</span><span class="p">:</span>
        
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">n_BTC</span> <span class="o">-</span> <span class="n">n_test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>


    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test:&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Definir los rangos de valores para p, d, q</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente autorregresivo</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Orden de diferenciación</span>
    <span class="n">q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente de media móvil</span>


    <span class="n">best_order_aic</span><span class="p">,</span> <span class="n">best_aic</span> <span class="o">=</span> <span class="n">grid_search_ARIMA_AIC</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejor modelo ARIMA basado en el criterio de Akaike:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AIC: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_aic</span><span class="p">,</span> <span class="n">best_order_aic</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
train: (2238,)
test: (7,)
Mejor modelo ARIMA basado en el criterio de Akaike:
AIC: 37019.48659 | order: (4, 1, 3)
Horizonte = 14
train: (2231,)
test: (14,)
Mejor modelo ARIMA basado en el criterio de Akaike:
AIC: 36909.98091 | order: (2, 2, 3)
Horizonte = 21
train: (2224,)
test: (21,)
Mejor modelo ARIMA basado en el criterio de Akaike:
AIC: 36801.36944 | order: (2, 2, 3)
Horizonte = 28
train: (2217,)
test: (28,)
Mejor modelo ARIMA basado en el criterio de Akaike:
AIC: 36691.56045 | order: (2, 2, 3)
</pre></div>
</div>
</div>
</div>
<p>Estos resultados muestran que para diferentes horizontes de predicción, se han encontrado modelos ARIMA óptimos basados en el AIC. Los valores de AIC indican la calidad del ajuste del modelo, y en este caso, los modelos con menor AIC se consideran los mejores modelos para cada horizonte.</p>
<p>De los dos posibles modelos ARIMA encontrados, decidimos elegir el modelo (4,1,3) , ya que este no tiene orden 2 de diferenciación, y las gráficas de autocorrelación nos indican que una diferenciación de orden dos podría ser innecesaria. Vamos a utilizar este modelo para realizar predicciones en todos los horizontes de tiempo. Luego, evaluaremos el desempeño de las predicciones utilizando varias métricas, como el error absoluto porcentual medio (MAPE), el error absoluto medio (MAE), la raíz del error cuadrático medio (RMSE), el error cuadrático medio (MSE) y el coeficiente de determinación (R^2) para determinar qué tan bien se ajusta el modelo a los diferentes horizontes de predicción.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order_aic</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">best_order_aic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 1, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hzt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span> 

<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">hzt_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">n_BTC</span> <span class="o">-</span> <span class="n">n_test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   
    <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order_aic</span><span class="p">)</span>
    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plot_predict</span><span class="p">(</span><span class="n">model_fit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/42c025d084162eb36ea6e57e65f91bbdc43d73ff40e239fc1e4a4fcf9d45f21c.png" src="_images/42c025d084162eb36ea6e57e65f91bbdc43d73ff40e239fc1e4a4fcf9d45f21c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 14
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/33f951666b73bfedbd4e3ba33efaece6c2bfcdc2cff32030409d0d70d03b3659.png" src="_images/33f951666b73bfedbd4e3ba33efaece6c2bfcdc2cff32030409d0d70d03b3659.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 21
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/17132328ce213cebb621ac44b59ef3c51648af7e4893ff080d69193abbc6596c.png" src="_images/17132328ce213cebb621ac44b59ef3c51648af7e4893ff080d69193abbc6596c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 28
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/3115671e863fd21dfbab4c129716773268fd23c196f1f87345c4401a73d3a6f1.png" src="_images/3115671e863fd21dfbab4c129716773268fd23c196f1f87345c4401a73d3a6f1.png" />
</div>
</div>
<p>los gráficos que se muestran en el código anterior muestran cómo se ajusta el modelo ARIMA a los datos de entrenamiento, pero para evaluar verdaderamente la calidad del modelo, es esencial probarlo con datos desconocidos (datos de prueba). La predicción y el ajuste del modelo en los datos de entrenamiento no son suficientes para determinar su capacidad de generalización y precisión en situaciones del mundo real.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
    
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                 <span class="c1"># MAE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>               <span class="c1"># RMSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># MSE</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    
    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                           <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                           <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                           <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
                           <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">]},</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_o</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_o</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yhat</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<p>El siguiente código realiza la predición en los datos de prueba (cada horizonte) y, por medio de gráficos, nos muestra la comparación entre los datos predichos y los esperados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Train_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2245
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Test_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hzt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span> 
<span class="n">results_AIC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Horizonte&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">])</span>
<span class="n">row_index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">hzt_values</span><span class="p">:</span>
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">dates_train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>
    <span class="n">dates_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_aic</span><span class="p">)</span>
    <span class="n">df_acc</span><span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="n">n_test</span><span class="p">)</span>
    <span class="n">results_AIC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_test</span><span class="p">,</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAPE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R2&#39;</span><span class="p">]]</span>
    <span class="n">row_index</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pronóstico - Horizonte </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>predicted=27570.510318, expected=27390.120000
predicted=27299.758550, expected=26875.520000
predicted=26861.997748, expected=26759.630000
predicted=26755.727283, expected=26862.000000
predicted=26833.819131, expected=26852.480000
predicted=26862.299600, expected=27154.150000
predicted=27121.700848, expected=28500.780000
Horizonte = 14
predicted=27570.510318, expected=27390.120000
predicted=27299.758550, expected=26875.520000
predicted=26861.997748, expected=26759.630000
predicted=26755.727283, expected=26862.000000
predicted=26833.819131, expected=26852.480000
predicted=26862.299600, expected=27154.150000
predicted=27121.700848, expected=28500.780000
predicted=28494.553105, expected=28395.910000
predicted=28405.828805, expected=28320.000000
predicted=28313.805860, expected=28713.710000
predicted=28732.684061, expected=29669.040000
predicted=29652.987253, expected=29909.800000
predicted=29908.123373, expected=29992.460000
predicted=29976.730688, expected=33069.990000
Horizonte = 21
predicted=27570.510318, expected=27390.120000
predicted=27299.758550, expected=26875.520000
predicted=26861.997748, expected=26759.630000
predicted=26755.727283, expected=26862.000000
predicted=26833.819131, expected=26852.480000
predicted=26862.299600, expected=27154.150000
predicted=27121.700848, expected=28500.780000
predicted=28494.553105, expected=28395.910000
predicted=28405.828805, expected=28320.000000
predicted=28313.805860, expected=28713.710000
predicted=28732.684061, expected=29669.040000
predicted=29652.987253, expected=29909.800000
predicted=29908.123373, expected=29992.460000
predicted=29976.730688, expected=33069.990000
predicted=33010.742687, expected=33922.730000
predicted=33960.429070, expected=34496.050000
predicted=34537.861691, expected=34151.660000
predicted=34192.303259, expected=33892.020000
predicted=33895.461303, expected=34081.000000
predicted=34203.546265, expected=34525.890000
predicted=34600.180072, expected=34474.730000
Horizonte = 28
predicted=27570.510318, expected=27390.120000
predicted=27299.758550, expected=26875.520000
predicted=26861.997748, expected=26759.630000
predicted=26755.727283, expected=26862.000000
predicted=26833.819131, expected=26852.480000
predicted=26862.299600, expected=27154.150000
predicted=27121.700848, expected=28500.780000
predicted=28494.553105, expected=28395.910000
predicted=28405.828805, expected=28320.000000
predicted=28313.805860, expected=28713.710000
predicted=28732.684061, expected=29669.040000
predicted=29652.987253, expected=29909.800000
predicted=29908.123373, expected=29992.460000
predicted=29976.730688, expected=33069.990000
predicted=33010.742687, expected=33922.730000
predicted=33960.429070, expected=34496.050000
predicted=34537.861691, expected=34151.660000
predicted=34192.303259, expected=33892.020000
predicted=33895.461303, expected=34081.000000
predicted=34203.546265, expected=34525.890000
predicted=34600.180072, expected=34474.730000
predicted=34390.981457, expected=34639.770000
predicted=34682.681083, expected=35421.430000
predicted=35445.933584, expected=34941.590000
predicted=34977.596486, expected=34716.780000
predicted=34787.842782, expected=35062.070000
predicted=35087.057448, expected=35011.880000
predicted=35017.268959, expected=34826.650000
</pre></div>
</div>
<img alt="_images/39bfb0f272df8880fc9ccb894910491a84c4a1192a0415db72bc57ef1a3a5cc5.png" src="_images/39bfb0f272df8880fc9ccb894910491a84c4a1192a0415db72bc57ef1a3a5cc5.png" />
<img alt="_images/d1dfc712c6e0462bff12a4c4ce100016c68de100b233cf45c3c64ebc32ed6e3f.png" src="_images/d1dfc712c6e0462bff12a4c4ce100016c68de100b233cf45c3c64ebc32ed6e3f.png" />
<img alt="_images/8be57917b2faf0d3d17fc8493e98b8266e60e2aaaa098503b2bef9e9dcc37efc.png" src="_images/8be57917b2faf0d3d17fc8493e98b8266e60e2aaaa098503b2bef9e9dcc37efc.png" />
<img alt="_images/a82d6b18790c9018e8e1c28bde2af6e9f11148cedf1d10094711eae8a9f96c97.png" src="_images/a82d6b18790c9018e8e1c28bde2af6e9f11148cedf1d10094711eae8a9f96c97.png" />
</div>
</div>
<ul class="simple">
<li><p>Métricas: A medida que aumenta el horizonte, el modelo explica un porcentaje mayor de la variabilidad de los datos:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_AIC</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Horizonte</th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>357.551394</td>
      <td>317382.321776</td>
      <td>0.013182</td>
      <td>563.366951</td>
      <td>0.018911</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>532.714316</td>
      <td>922626.977577</td>
      <td>0.018581</td>
      <td>960.534735</td>
      <td>0.682192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.0</td>
      <td>486.925054</td>
      <td>687084.662869</td>
      <td>0.016287</td>
      <td>828.905702</td>
      <td>0.926331</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28.0</td>
      <td>447.076689</td>
      <td>552714.254124</td>
      <td>0.014561</td>
      <td>743.447546</td>
      <td>0.949365</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="criterio-de-informacion-de-hannan-quinn-hqic">
<h4>Criterio de Información de Hannan-Quinn (HQIC)<a class="headerlink" href="#criterio-de-informacion-de-hannan-quinn-hqic" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grid_search_ARIMA_HQIC</span><span class="p">(</span><span class="n">serie</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">best_order_hqic</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">best_hqic</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="c1"># Generar todas las combinaciones posibles de valores de p, d, q</span>
    <span class="c1">#los parámetros p (orden del componente autorregresivo),</span>
    <span class="c1">#  d (orden de diferenciación) y </span>
    <span class="c1"># q (orden del componente de media móvil).</span>
    <span class="n">orders</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp_model</span><span class="o">=</span><span class="n">ARIMA</span><span class="p">(</span><span class="n">serie</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">tm_hqic</span> <span class="o">=</span> <span class="n">tmp_model</span><span class="o">.</span><span class="n">hqic</span>
            <span class="k">if</span> <span class="n">tm_hqic</span><span class="o">&lt;</span><span class="n">best_hqic</span><span class="p">:</span>
                <span class="n">best_hqic</span><span class="o">=</span><span class="n">tm_hqic</span>
                <span class="n">best_order_hqic</span><span class="o">=</span><span class="n">order</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">best_order_hqic</span><span class="p">,</span><span class="n">best_hqic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Train_size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2245
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hzt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  <span class="c1"># Valores de horizontes</span>

<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">hzt_values</span><span class="p">:</span>
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span> <span class="o">-</span> <span class="n">n_test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test:&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Definir los rangos de valores para p, d, q</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente autorregresivo</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Orden de diferenciación</span>
    <span class="n">q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Orden del componente de media móvil</span>


    <span class="n">best_order_hqic</span><span class="p">,</span> <span class="n">best_hqic</span><span class="o">=</span> <span class="n">grid_search_ARIMA_HQIC</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejor modelo ARIMA basado en el criterio de Información de Hannan-Quinn:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HQIC: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_hqic</span><span class="p">,</span> <span class="n">best_order_hqic</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
train: (2238,)
test: (7,)
Mejor modelo ARIMA basado en el criterio de Información de Hannan-Quinn:
HQIC: 37036.17288 | order: (4, 1, 3)
Horizonte = 14
train: (2231,)
test: (14,)
Mejor modelo ARIMA basado en el criterio de Información de Hannan-Quinn:
HQIC: 36922.49005 | order: (2, 2, 3)
Horizonte = 21
train: (2224,)
test: (21,)
Mejor modelo ARIMA basado en el criterio de Información de Hannan-Quinn:
HQIC: 36813.87368 | order: (2, 2, 3)
Horizonte = 28
train: (2217,)
test: (28,)
Mejor modelo ARIMA basado en el criterio de Información de Hannan-Quinn:
HQIC: 36704.05978 | order: (2, 2, 3)
</pre></div>
</div>
</div>
</div>
<p>Vemos que ambos criterios de selección de modelos llegaron a las mismas dos opciones de modelos posibles.</p>
<p>Hemos decidido considerar el modelo con orden de diferenciación 2 ya que nos interesa saber cual de los dos posibles modelos generaliza mejor y también si una segunda diferenciación mejora o no la predicción en la serie de tiempo. Vamos a utilizar este modelo para realizar predicciones en todos los horizontes de tiempo. Luego, evaluaremos el desempeño de las predicciones utilizando varias métricas, como el error absoluto porcentual medio (MAPE), el error absoluto medio (MAE), la raíz del error cuadrático medio (RMSE), el error cuadrático medio (MSE) y el coeficiente de determinación (R^2) para determinar qué tan bien se ajusta el modelo a los diferentes horizontes de predicción.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order_hqic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 2, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">n_BTC</span> <span class="o">-</span> <span class="n">n_test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   
    <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order_hqic</span><span class="p">)</span>
    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plot_predict</span><span class="p">(</span><span class="n">model_fit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/186ca1af362c9b809fcc8aea94bf2aa70d9f3c70321b8ea94e610c625bdc6277.png" src="_images/186ca1af362c9b809fcc8aea94bf2aa70d9f3c70321b8ea94e610c625bdc6277.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 14
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/fab1ed8aea2f1097587f5f2ea0a347893908b23d2899a04af267f601e0603016.png" src="_images/fab1ed8aea2f1097587f5f2ea0a347893908b23d2899a04af267f601e0603016.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 21
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/cb9792469d445cb7fc599ad1cba367993e284239a3d699ada3de5005a2c878c6.png" src="_images/cb9792469d445cb7fc599ad1cba367993e284239a3d699ada3de5005a2c878c6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 28
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/5320985de10857f24d2e65db936125cb9e8e057f1ef8c0334ce5bbf67553db3d.png" src="_images/5320985de10857f24d2e65db936125cb9e8e057f1ef8c0334ce5bbf67553db3d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="n">result_HQIC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Horizonte&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">])</span>
<span class="n">row_index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">dates_train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
    <span class="n">dates_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_hqic</span><span class="p">)</span>
    <span class="n">df_acc</span><span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="n">n_test</span><span class="p">)</span>
    <span class="n">result_HQIC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_test</span><span class="p">,</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAPE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R2&#39;</span><span class="p">]]</span>
    <span class="n">row_index</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pronóstico - Horizonte </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
predicted=27603.525906, expected=27390.120000
predicted=27361.499183, expected=26875.520000
predicted=26926.693278, expected=26759.630000
predicted=26732.963733, expected=26862.000000
predicted=26877.742176, expected=26852.480000
predicted=26848.924788, expected=27154.150000
predicted=27135.944747, expected=28500.780000
Horizonte = 14
predicted=27603.525906, expected=27390.120000
predicted=27361.499183, expected=26875.520000
predicted=26926.693278, expected=26759.630000
predicted=26732.963733, expected=26862.000000
predicted=26877.742176, expected=26852.480000
predicted=26848.924788, expected=27154.150000
predicted=27135.944747, expected=28500.780000
predicted=28524.312814, expected=28395.910000
predicted=28388.223859, expected=28320.000000
predicted=28361.480455, expected=28713.710000
predicted=28695.988803, expected=29669.040000
predicted=29704.490164, expected=29909.800000
predicted=29878.685382, expected=29992.460000
predicted=30045.658025, expected=33069.990000
Horizonte = 21
predicted=27603.525906, expected=27390.120000
predicted=27361.499183, expected=26875.520000
predicted=26926.693278, expected=26759.630000
predicted=26732.963733, expected=26862.000000
predicted=26877.742176, expected=26852.480000
predicted=26848.924788, expected=27154.150000
predicted=27135.944747, expected=28500.780000
predicted=28524.312814, expected=28395.910000
predicted=28388.223859, expected=28320.000000
predicted=28361.480455, expected=28713.710000
predicted=28695.988803, expected=29669.040000
predicted=29704.490164, expected=29909.800000
predicted=29878.685382, expected=29992.460000
predicted=30045.658025, expected=33069.990000
predicted=33086.704008, expected=33922.730000
predicted=33995.457574, expected=34496.050000
predicted=34475.432351, expected=34151.660000
predicted=34208.485881, expected=33892.020000
predicted=33902.841741, expected=34081.000000
predicted=34062.366689, expected=34525.890000
predicted=34484.351499, expected=34474.730000
Horizonte = 28
predicted=27603.525906, expected=27390.120000
predicted=27361.499183, expected=26875.520000
predicted=26926.693278, expected=26759.630000
predicted=26732.963733, expected=26862.000000
predicted=26877.742176, expected=26852.480000
predicted=26848.924788, expected=27154.150000
predicted=27135.944747, expected=28500.780000
predicted=28524.312814, expected=28395.910000
predicted=28388.223859, expected=28320.000000
predicted=28361.480455, expected=28713.710000
predicted=28695.988803, expected=29669.040000
predicted=29704.490164, expected=29909.800000
predicted=29878.685382, expected=29992.460000
predicted=30045.658025, expected=33069.990000
predicted=33086.704008, expected=33922.730000
predicted=33995.457574, expected=34496.050000
predicted=34475.432351, expected=34151.660000
predicted=34208.485881, expected=33892.020000
predicted=33902.841741, expected=34081.000000
predicted=34062.366689, expected=34525.890000
predicted=34484.351499, expected=34474.730000
predicted=34547.499166, expected=34639.770000
predicted=34622.171807, expected=35421.430000
predicted=35359.225280, expected=34941.590000
predicted=35052.000565, expected=34716.780000
predicted=34687.987272, expected=35062.070000
predicted=35127.088374, expected=35011.880000
predicted=35000.619987, expected=34826.650000
</pre></div>
</div>
<img alt="_images/6eac74338702576288d561be50646a3e5808ca8e403898082e643ab0aa3398cc.png" src="_images/6eac74338702576288d561be50646a3e5808ca8e403898082e643ab0aa3398cc.png" />
<img alt="_images/d81b0a49219f0e8e4730aa1af73e9288bfa556e9beb9fb4cda7aa7846261c12c.png" src="_images/d81b0a49219f0e8e4730aa1af73e9288bfa556e9beb9fb4cda7aa7846261c12c.png" />
<img alt="_images/dbf62ef4194bbfe8761e82e784b618144f114f544ec34834b4026a4c0417123f.png" src="_images/dbf62ef4194bbfe8761e82e784b618144f114f544ec34834b4026a4c0417123f.png" />
<img alt="_images/c0ceb901ff23fd088ee80ebe7c6c5d465102bfed843791224750de34cfaa3b95.png" src="_images/c0ceb901ff23fd088ee80ebe7c6c5d465102bfed843791224750de34cfaa3b95.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_HQIC</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Horizonte</th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>384.401039</td>
      <td>326122.031461</td>
      <td>0.014161</td>
      <td>571.070951</td>
      <td>-0.008105</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>539.723651</td>
      <td>898326.497826</td>
      <td>0.018838</td>
      <td>947.800875</td>
      <td>0.690562</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.0</td>
      <td>484.966230</td>
      <td>665608.056796</td>
      <td>0.016263</td>
      <td>815.848060</td>
      <td>0.928634</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28.0</td>
      <td>446.140600</td>
      <td>539120.186620</td>
      <td>0.014560</td>
      <td>734.248042</td>
      <td>0.950610</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>El coeficiente de determinación (R2) también aumenta, no debería ser así, ya que  a medida que el horizonte aumenta el porcentaje de varianza explicada debería disminuir. Aparentemente una segunda diferenciación es innecesaria, puesto que se obtuvieron resultados similares que al usar un modelo de orden 1. Se propone el no uso de la técnica rolling para verificar los resultados obtenidos en dichas métricas.</p></li>
</ul>
</section>
<section id="prueba-de-normalidad-en-los-residuos">
<h4>Prueba de normalidad en los residuos<a class="headerlink" href="#prueba-de-normalidad-en-los-residuos" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Criterio de Akaike:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling_error</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_or</span><span class="p">):</span>
    <span class="n">error_aic</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_or</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">error_aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span>
        <span class="c1">#prueba de normalidad en los residuales (Shapiro-Wilk)</span>
    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">error_aic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico de prueba de normalidad: </span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valor p: </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span> 
    <span class="k">if</span> <span class="n">p_value</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuales siguen una distribución normal (no se rechaza H0)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuales no siguen una distribución normal (se rechaza H0)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">error_aic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
    

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">error_aic</span>  <span class="o">=</span> <span class="n">arima_rolling_error</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_aic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
Estadístico de prueba de normalidad: 0.8186613917350769
Valor p: 0.06233812868595123
Los residuales siguen una distribución normal (no se rechaza H0)
Horizonte = 14
Estadístico de prueba de normalidad: 0.7249640226364136
Valor p: 0.0006784417200833559
Los residuales no siguen una distribución normal (se rechaza H0)
Horizonte = 21
Estadístico de prueba de normalidad: 0.7494720220565796
Valor p: 0.00012189211702207103
Los residuales no siguen una distribución normal (se rechaza H0)
Horizonte = 28
Estadístico de prueba de normalidad: 0.7569465041160583
Valor p: 2.031257827184163e-05
Los residuales no siguen una distribución normal (se rechaza H0)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Criterio de Información de Hannan-Quinn (HQIC)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling1_error</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_or</span><span class="p">):</span>
    <span class="n">error_hqic</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_or</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">error_hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span>
        <span class="c1">#prueba de normalidad en los residuales (Shapiro-Wilk)</span>
    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">error_hqic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico de prueba de normalidad: </span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valor p: </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span> 
    <span class="k">if</span> <span class="n">p_value</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuales siguen una distribución normal (no se rechaza H0)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuales no siguen una distribución normal (se rechaza H0)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">error_hqic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_rolling1_error</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_hqic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
Estadístico de prueba de normalidad: 0.8444534540176392
Valor p: 0.10928093641996384
Los residuales siguen una distribución normal (no se rechaza H0)
Horizonte = 14
Estadístico de prueba de normalidad: 0.7444614171981812
Valor p: 0.0011107135796919465
Los residuales no siguen una distribución normal (se rechaza H0)
Horizonte = 21
Estadístico de prueba de normalidad: 0.7654687166213989
Valor p: 0.00020364813099149615
Los residuales no siguen una distribución normal (se rechaza H0)
Horizonte = 28
Estadístico de prueba de normalidad: 0.7665688991546631
Valor p: 2.9009152058279142e-05
Los residuales no siguen una distribución normal (se rechaza H0)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="enfoque-sin-rolling">
<h3>ENFOQUE SIN ROLLING<a class="headerlink" href="#enfoque-sin-rolling" title="Permalink to this heading">#</a></h3>
<section id="id1">
<h4>Criterio de Akaike (AIC)<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<p>En la sección anterior se determinó los mejores hiperparámetros para el modelo ARIMA con menor AIC. A continuación, se realizará el ajuste y evaluación de este modelo para todos los horizontes sin aplicar la técnica rolling, se espera obtener una apropiada evaluación de la generalización del modelo según las métricas establecidas anteriormente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order_aic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 1, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_sin_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">best_o</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_o</span><span class="p">)</span>
    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="n">predictions</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>      
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predicted=</span><span class="si">%f</span><span class="s1">, expected=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="n">result_AIC_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Horizonte&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">])</span>
<span class="n">row_index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">dates_train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
    <span class="n">dates_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_sin_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_aic</span><span class="p">)</span>
    <span class="n">df_acc</span><span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="n">n_test</span><span class="p">)</span>
    <span class="n">result_AIC_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_test</span><span class="p">,</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAPE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R2&#39;</span><span class="p">]]</span>
    <span class="n">row_index</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pronóstico - Horizonte </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
predicted=27570.510318, expected=27390.120000
predicted=27561.186563, expected=26875.520000
predicted=27602.057287, expected=26759.630000
predicted=27591.127807, expected=26862.000000
predicted=27559.861940, expected=26852.480000
predicted=27590.725546, expected=27154.150000
predicted=27606.376554, expected=28500.780000
Horizonte = 14
predicted=27570.510318, expected=27390.120000
predicted=27561.186563, expected=26875.520000
predicted=27602.057287, expected=26759.630000
predicted=27591.127807, expected=26862.000000
predicted=27559.861940, expected=26852.480000
predicted=27590.725546, expected=27154.150000
predicted=27606.376554, expected=28500.780000
predicted=27569.027467, expected=28395.910000
predicted=27576.241375, expected=28320.000000
predicted=27610.446335, expected=28713.710000
predicted=27585.337078, expected=29669.040000
predicted=27566.805766, expected=29909.800000
predicted=27602.929064, expected=29992.460000
predicted=27601.704597, expected=33069.990000
Horizonte = 21
predicted=27570.510318, expected=27390.120000
predicted=27561.186563, expected=26875.520000
predicted=27602.057287, expected=26759.630000
predicted=27591.127807, expected=26862.000000
predicted=27559.861940, expected=26852.480000
predicted=27590.725546, expected=27154.150000
predicted=27606.376554, expected=28500.780000
predicted=27569.027467, expected=28395.910000
predicted=27576.241375, expected=28320.000000
predicted=27610.446335, expected=28713.710000
predicted=27585.337078, expected=29669.040000
predicted=27566.805766, expected=29909.800000
predicted=27602.929064, expected=29992.460000
predicted=27601.704597, expected=33069.990000
predicted=27567.478154, expected=33922.730000
predicted=27588.551516, expected=34496.050000
predicted=27610.989700, expected=34151.660000
predicted=27578.054062, expected=33892.020000
predicted=27574.854036, expected=34081.000000
predicted=27609.486808, expected=34525.890000
predicted=27593.471218, expected=34474.730000
Horizonte = 28
predicted=27570.510318, expected=27390.120000
predicted=27561.186563, expected=26875.520000
predicted=27602.057287, expected=26759.630000
predicted=27591.127807, expected=26862.000000
predicted=27559.861940, expected=26852.480000
predicted=27590.725546, expected=27154.150000
predicted=27606.376554, expected=28500.780000
predicted=27569.027467, expected=28395.910000
predicted=27576.241375, expected=28320.000000
predicted=27610.446335, expected=28713.710000
predicted=27585.337078, expected=29669.040000
predicted=27566.805766, expected=29909.800000
predicted=27602.929064, expected=29992.460000
predicted=27601.704597, expected=33069.990000
predicted=27567.478154, expected=33922.730000
predicted=27588.551516, expected=34496.050000
predicted=27610.989700, expected=34151.660000
predicted=27578.054062, expected=33892.020000
predicted=27574.854036, expected=34081.000000
predicted=27609.486808, expected=34525.890000
predicted=27593.471218, expected=34474.730000
predicted=27568.590108, expected=34639.770000
predicted=27598.609199, expected=35421.430000
predicted=27606.465031, expected=34941.590000
predicted=27572.617193, expected=34716.780000
predicted=27584.058048, expected=35062.070000
predicted=27611.136269, expected=35011.880000
predicted=27584.739381, expected=34826.650000
</pre></div>
</div>
<img alt="_images/7269931df64f2f5280ffe52f785c5d4c4bb455db0a40041f8d4910193b4f6840.png" src="_images/7269931df64f2f5280ffe52f785c5d4c4bb455db0a40041f8d4910193b4f6840.png" />
<img alt="_images/4c0668b9b933b4fedc1fce1193bce42a5c8ccc37764940e7bef250fa55f8b996.png" src="_images/4c0668b9b933b4fedc1fce1193bce42a5c8ccc37764940e7bef250fa55f8b996.png" />
<img alt="_images/436c16248b3f5540ddac6f8e20295dc6ff2b56bfed29e10300e2e619bd329017.png" src="_images/436c16248b3f5540ddac6f8e20295dc6ff2b56bfed29e10300e2e619bd329017.png" />
<img alt="_images/80aa9b2eeaca22e6460b601f3c4a7374d63e4f23c01da343f70fda532e953461.png" src="_images/80aa9b2eeaca22e6460b601f3c4a7374d63e4f23c01da343f70fda532e953461.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_AIC_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Horizonte</th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>639.424701</td>
      <td>4.621336e+05</td>
      <td>0.023179</td>
      <td>679.804104</td>
      <td>-0.428543</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>1388.170802</td>
      <td>3.652320e+06</td>
      <td>0.050314</td>
      <td>1911.104409</td>
      <td>-0.258080</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.0</td>
      <td>3135.980273</td>
      <td>1.711429e+07</td>
      <td>0.113665</td>
      <td>4136.941974</td>
      <td>-0.834987</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28.0</td>
      <td>4191.055018</td>
      <td>2.637779e+07</td>
      <td>0.151907</td>
      <td>5135.931678</td>
      <td>-1.416515</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id2">
<h4>Criterio de Información de Hannan-Quinn (HQIC)<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p>En la sección anterior se determinó los mejores hiperparámetros para el modelo ARIMA con menor HQIC. A continuación, se realizará el ajuste y evaluación de este modelo para todos los horizontes sin aplicar la técnica rolling, se espera obtener una apropiada evaluación de la generalización del modelo según las métricas establecidas anteriormente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order_hqic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2, 2, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>  
<span class="n">result_HQIC_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Horizonte&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">])</span>
<span class="n">row_index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">n_test</span> <span class="ow">in</span> <span class="n">n_test_values</span><span class="p">:</span>
    
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">Train_size</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">dates_train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
    <span class="n">dates_1w</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Horizonte = </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">test_1wl</span> <span class="o">=</span> <span class="n">test_1w</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">yhat_1w</span>  <span class="o">=</span> <span class="n">arima_sin_rolling</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">test_1wl</span><span class="p">,</span> <span class="n">best_order_hqic</span><span class="p">)</span>
    <span class="n">df_acc</span><span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_1wl</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yhat_1w</span><span class="p">),</span> <span class="n">n_test</span><span class="p">)</span>
    <span class="n">result_HQIC_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_test</span><span class="p">,</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;MAPE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;R2&#39;</span><span class="p">]]</span>
    <span class="n">row_index</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_1wl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates_1w</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yhat_1w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pronóstico - Horizonte </span><span class="si">{</span><span class="n">n_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Horizonte = 7
predicted=27603.525906, expected=27390.120000
predicted=27608.779308, expected=26875.520000
predicted=27629.263275, expected=26759.630000
predicted=27629.291662, expected=26862.000000
predicted=27652.622105, expected=26852.480000
predicted=27652.433588, expected=27154.150000
predicted=27673.395265, expected=28500.780000
Horizonte = 14
predicted=27603.525906, expected=27390.120000
predicted=27608.779308, expected=26875.520000
predicted=27629.263275, expected=26759.630000
predicted=27629.291662, expected=26862.000000
predicted=27652.622105, expected=26852.480000
predicted=27652.433588, expected=27154.150000
predicted=27673.395265, expected=28500.780000
predicted=27677.834760, expected=28395.910000
predicted=27692.475044, expected=28320.000000
predicted=27704.192245, expected=28713.710000
predicted=27711.421512, expected=29669.040000
predicted=27729.866604, expected=29909.800000
predicted=27731.771585, expected=29992.460000
predicted=27753.589405, expected=33069.990000
Horizonte = 21
predicted=27603.525906, expected=27390.120000
predicted=27608.779308, expected=26875.520000
predicted=27629.263275, expected=26759.630000
predicted=27629.291662, expected=26862.000000
predicted=27652.622105, expected=26852.480000
predicted=27652.433588, expected=27154.150000
predicted=27673.395265, expected=28500.780000
predicted=27677.834760, expected=28395.910000
predicted=27692.475044, expected=28320.000000
predicted=27704.192245, expected=28713.710000
predicted=27711.421512, expected=29669.040000
predicted=27729.866604, expected=29909.800000
predicted=27731.771585, expected=29992.460000
predicted=27753.589405, expected=33069.990000
predicted=27754.392972, expected=33922.730000
predicted=27774.978537, expected=34496.050000
predicted=27779.152768, expected=34151.660000
predicted=27794.654080, expected=33892.020000
predicted=27805.024284, expected=34081.000000
predicted=27813.926237, expected=34525.890000
predicted=27830.564835, expected=34474.730000
Horizonte = 28
predicted=27603.525906, expected=27390.120000
predicted=27608.779308, expected=26875.520000
predicted=27629.263275, expected=26759.630000
predicted=27629.291662, expected=26862.000000
predicted=27652.622105, expected=26852.480000
predicted=27652.433588, expected=27154.150000
predicted=27673.395265, expected=28500.780000
predicted=27677.834760, expected=28395.910000
predicted=27692.475044, expected=28320.000000
predicted=27704.192245, expected=28713.710000
predicted=27711.421512, expected=29669.040000
predicted=27729.866604, expected=29909.800000
predicted=27731.771585, expected=29992.460000
predicted=27753.589405, expected=33069.990000
predicted=27754.392972, expected=33922.730000
predicted=27774.978537, expected=34496.050000
predicted=27779.152768, expected=34151.660000
predicted=27794.654080, expected=33892.020000
predicted=27805.024284, expected=34081.000000
predicted=27813.926237, expected=34525.890000
predicted=27830.564835, expected=34474.730000
predicted=27834.208497, expected=34639.770000
predicted=27854.544441, expected=35421.430000
predicted=27856.417124, expected=34941.590000
predicted=27876.452991, expected=34716.780000
predicted=27880.610571, expected=35062.070000
predicted=27896.678477, expected=35011.880000
predicted=27906.008459, expected=34826.650000
</pre></div>
</div>
<img alt="_images/885629f0751d66b7f277ed504126959c5fbf5b5a755c640f999c51c8d5d87f7b.png" src="_images/885629f0751d66b7f277ed504126959c5fbf5b5a755c640f999c51c8d5d87f7b.png" />
<img alt="_images/153466161b2f2cae220712b33e8f9095dba3e87ee1229e947fe5923ef0be836e.png" src="_images/153466161b2f2cae220712b33e8f9095dba3e87ee1229e947fe5923ef0be836e.png" />
<img alt="_images/d3f04554d593aeaed4e39c625e16dd2abea10cbdcf2e3c3d6ab16f1e4f28b769.png" src="_images/d3f04554d593aeaed4e39c625e16dd2abea10cbdcf2e3c3d6ab16f1e4f28b769.png" />
<img alt="_images/5ed7e55f3726a42f95de10c68348c7075283c596be4e8168310abfefb17041d1.png" src="_images/5ed7e55f3726a42f95de10c68348c7075283c596be4e8168310abfefb17041d1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_HQIC_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Horizonte</th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>672.771512</td>
      <td>5.001842e+05</td>
      <td>0.024341</td>
      <td>707.237003</td>
      <td>-0.546165</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>1341.368530</td>
      <td>3.384932e+06</td>
      <td>0.048412</td>
      <td>1839.818355</td>
      <td>-0.165975</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.0</td>
      <td>3036.692653</td>
      <td>1.604668e+07</td>
      <td>0.109359</td>
      <td>4005.830301</td>
      <td>-0.720518</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28.0</td>
      <td>4045.921255</td>
      <td>2.455850e+07</td>
      <td>0.145466</td>
      <td>4955.653729</td>
      <td>-1.249847</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
</section>
<section id="conclusiones">
<h2>CONCLUSIONES<a class="headerlink" href="#conclusiones" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Se excluyó el criterio BIC ya que no arrojaba modelos que tuvieran sentido de implementar. Se verificó si la función estaba llamando correctamente el BIC y en efecto sí, pero los modelos propuestos siempre eran con orden (0,1,0).</p></li>
<li><p>Se consideró como criterio el HQIC para la selección de mejores modelos ARIMA y se realizó la comparación con los propuestos por el criterio AIC.</p></li>
<li><p>se realizó la evaluación de las métricas haciendo rolling y sin rolling también. se encontró que los modelos propuestos no tienen una buena generalización.</p></li>
<li><p>Los residuos no siguen una distribución normal para los horizontes diferentes a 7. Se propone considerar alguna transformación de los datos , como también otro posible modelo para pronostico de la serie de tiempo.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">TAREA 2: SERIES DE TIEMPO</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos-eda">ANÁLISIS EXPLORATORIO DE LOS DATOS (EDA)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-faltantes">Datos faltantes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-arima">MODELO ARIMA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-rolling">ENFOQUE ROLLING</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-akaike-aic">Criterio de Akaike (AIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-informacion-de-hannan-quinn-hqic">Criterio de Información de Hannan-Quinn (HQIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-de-normalidad-en-los-residuos">Prueba de normalidad en los residuos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-sin-rolling">ENFOQUE SIN ROLLING</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Criterio de Akaike (AIC)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Criterio de Información de Hannan-Quinn (HQIC)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">CONCLUSIONES</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angie Vanesa Guerrero Bertel y Karina Rodríguez Barragan
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>